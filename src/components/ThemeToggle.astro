---
---

<button class="theme-toggle" type="button" role="switch" aria-checked="false" aria-label="Toggle theme" title="Toggle theme">
  <svg class="theme-icon theme-icon-sun" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
  </svg>
  <svg class="theme-icon theme-icon-moon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
  </svg>
</button>

<style>
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.25rem;
    height: 2.25rem;
    background: transparent;
    border: 1px solid var(--color-border-light);
    border-radius: 0.375rem;
    color: var(--color-foreground);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }

  @media (min-width: 768px) {
    .theme-toggle {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 0.5rem;
    }
  }

  .theme-toggle:hover {
    background: var(--color-border);
    border-color: var(--color-surface-border);
  }

  .theme-icon {
    width: 1.125rem;
    height: 1.125rem;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
  }

  @media (min-width: 768px) {
    .theme-icon {
      width: 1.25rem;
      height: 1.25rem;
    }
  }

  .theme-icon-sun {
    display: block;
    transform: rotate(0deg) scale(1);
  }

  .theme-icon-moon {
    display: none;
    transform: rotate(-90deg) scale(0.8);
  }

  :global(.light) .theme-icon-sun {
    display: none;
    transform: rotate(90deg) scale(0.8);
  }

  :global(.light) .theme-icon-moon {
    display: block;
    transform: rotate(0deg) scale(1);
  }

  @media (prefers-reduced-motion: reduce) {
    .theme-icon {
      transition: none;
    }
  }
</style>

<script>
  function initThemeToggle() {
    const themeToggles = document.querySelectorAll('.theme-toggle');
    const html = document.documentElement;

    if (!themeToggles.length) return;

    // Set initial aria-checked state based on current theme
    const isLight = html.classList.contains('light');

    themeToggles.forEach((themeToggle) => {
      themeToggle.setAttribute('aria-checked', String(isLight));
      themeToggle.setAttribute('aria-label', isLight ? 'Switch to dark mode' : 'Switch to light mode');

      // Remove any existing listeners by cloning
      const newToggle = themeToggle.cloneNode(true) as HTMLElement;
      newToggle.setAttribute('aria-checked', String(isLight));
      newToggle.setAttribute('aria-label', isLight ? 'Switch to dark mode' : 'Switch to light mode');
      themeToggle.parentNode?.replaceChild(newToggle, themeToggle);

      // Toggle theme on button click
      newToggle.addEventListener('click', () => {
        const currentTheme = html.classList.contains('light') ? 'light' : 'dark';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';

        if (newTheme === 'light') {
          html.classList.add('light');
        } else {
          html.classList.remove('light');
        }
        localStorage.setItem('theme', newTheme);

        // Update aria attributes on all toggles
        document.querySelectorAll('.theme-toggle').forEach((toggle) => {
          toggle.setAttribute('aria-checked', String(newTheme === 'light'));
          toggle.setAttribute('aria-label', newTheme === 'light' ? 'Switch to dark mode' : 'Switch to light mode');
        });
      });
    });
  }

  // Run on initial load
  initThemeToggle();

  // Re-run after Astro page transitions
  document.addEventListener('astro:after-swap', initThemeToggle);
</script>
